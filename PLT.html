<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Visualizador del Tensor de Carga Pura (PLT)</title>
<style>
  :root {
    --bg: #0b1020;
    --fg: #eaf2ff;
    --accent: #5ec8ff;
    --accent2: #b0ffb5;
    --card-bg: rgba(255, 255, 255, 0.04);
    --border-color: rgba(255, 255, 255, 0.09);
  }
  html, body { height: 100%; margin: 0; background: var(--bg); color: var(--fg); font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; font-size: 14px; }
  .wrap { display: grid; grid-template-columns: 420px 1fr; gap: 16px; height: 100%; }
  .panel { padding: 16px; overflow-y: auto; }
  h1 { font-size: 20px; margin: 10px 0 6px; }
  h2 { font-size: 16px; margin: 14px 0 8px; opacity: .9; border-bottom: 1px solid var(--border-color); padding-bottom: 4px;}
  label { font-size: 13px; opacity: .85; display: block; margin-bottom: 4px; }
  input[type=range] { width: 100%; }
  select, input[type=range] { accent-color: var(--accent); }
  .card { background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 12px; padding: 16px; margin-bottom: 16px; }
  .scene { perspective: 1000px; height: 100%; display: grid; place-items: center; }
  .cube { position: relative; width: 300px; height: 300px; transform-style: preserve-3d; }
  .face { position: absolute; width: 300px; height: 300px; display: grid; place-items: center; border: 1px solid rgba(255,255,255,0.1); border-radius: 10px; font-weight: 600; text-align: center; padding: 10px; background: linear-gradient(180deg, rgba(94,200,255,.18), rgba(94,200,255,.05)); box-sizing: border-box; }
  .face small { display:block; font-weight: 400; opacity: .85; margin-top: 4px; }
  .face .big { font-size: 28px; line-height: 1.2; }
  .face .val { font-size: 22px; color: var(--accent2); font-family: ui-monospace, monospace; }
  .legend { font-size: 12px; line-height: 1.5; }
  .row { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; align-items: center; }
  .kbd { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; background: rgba(255,255,255,0.08); padding: 2px 6px; border-radius: 6px; }
  footer { font-size: 12px; opacity: .7; padding: 10px; text-align: center; }
  .dim-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; font-size: 13px; }
  .dim-item { display: flex; justify-content: space-between; background: rgba(0,0,0,0.2); padding: 4px 8px; border-radius: 6px; }
  .dim-item .label { opacity: 0.8; }

  /* === Dimension badges on cube faces === */
  .face .dimBadge {
    position: absolute;
    background: rgba(11, 17, 30, 0.80);
    color: #eaf2ff;
    border: 1px solid rgba(255,255,255,0.35);
    border-radius: 8px;
    padding: 3px 10px;
    font: 600 13px Inter, system-ui, sans-serif;
    letter-spacing: 0.2px;
    pointer-events: none;
    top: 8px;
    left: 8px;
  }
</style>
</head>
<body>
<div class="wrap">
  <div class="panel">
    <h1>Visualizador del Tensor de Carga Pura (PLT)</h1>
    <div class="card">
      <h2>Controles</h2>
      <label for="athSel">Atleta</label>
      <select id="athSel"></select>
      <div style="height:12px"></div>
      <label for="dayIdx">Índice del día <span id="dayLabel" class="kbd"></span></label>
      <input id="dayIdx" type="range" min="0" value="0" step="1"/>
    </div>

    <div class="card" id="plt-components-card">
        <h2>Componentes del PLT (Día Seleccionado)</h2>
        <div class="dim-grid">
            <div class="dim-item"><span class="label">TSS</span> <span id="val-tss" class="kbd"></span></div>
            <div class="dim-item"><span class="label">E_kg (kJ/kg)</span> <span id="val-ekg" class="kbd"></span></div>
            <div class="dim-item"><span class="label">HRV Pre (ms)</span> <span id="val-hrv-pre" class="kbd"></span></div>
            <div class="dim-item"><span class="label">HRV Post (ms)</span> <span id="val-hrv-post" class="kbd"></span></div>
            <div class="dim-item"><span class="label">λ_HRV (h⁻¹)</span> <span id="val-lambda" class="kbd">N/A</span></div>
            <div class="dim-item"><span class="label">HR Q1 (bpm)</span> <span id="val-hr-q1" class="kbd">N/A</span></div>
            <div class="dim-item"><span class="label">HR Q2 (bpm)</span> <span id="val-hr-q2" class="kbd">N/A</span></div>
            <div class="dim-item"><span class="label">HR Q3 (bpm)</span> <span id="val-hr-q3" class="kbd">N/A</span></div>
            <div class="dim-item"><span class="label">HR Q4 (bpm)</span> <span id="val-hr-q4" class="kbd">N/A</span></div>
        </div>
        <small style="display:block; margin-top:10px; opacity:0.7;">* Los 9 componentes del PLT según la Eq. (5) del paper. λ_HRV y HR Q1-Q4 no están en el dataset de ejemplo.</small>
    </div>

    <div class="card">
      <h2>Visualización</h2>
      <label for="spd">Velocidad de rotación: <span id="spdOut" class="kbd"></span></label>
      <input id="spd" type="range" min="0" max="120" step="1" value="20" />
      <div class="row">
        <label><input type="checkbox" id="pause"> Pausar</label>
        <label><input type="checkbox" id="autoroll" checked> Auto-rotar en X</label>
      </div>
    </div>
    <div class="card legend">
      <h2>Leyenda e Interpretación</h2>
      <p>Esta herramienta visualiza el <strong>Tensor de Carga Pura (PLT)</strong> como un cubo 3D. A diferencia del TSS, el PLT captura múltiples dimensiones del estímulo de entrenamiento.</p>
      <ul>
        <li><strong>Impulso Diario (u_PLT):</strong> Es un escalar derivado del tensor PLT que alimenta un modelo de Impulso-Respuesta (Fitness/Fatiga). Se muestra en la cara superior.</li>
        <li><strong>Caras del Cubo:</strong> Cada cara representa un componente clave del tensor, mostrando su valor para el día seleccionado.</li>
        <li><strong>Modelo IR:</strong> Los valores <strong>CTL (TSS)</strong> y <strong>F_tensor</strong> son las salidas del modelo de fitness/fatiga, mostrando la carga crónica.</li>
      </ul>
      <p><small>Basado en el estudio: <i>"Toward Hierarchical Tensor Representations of Endurance Training Stimulus"</i>.</small></p>
    </div>
    <footer>Teclas: <span class="kbd">←</span>/<span class="kbd">→</span> = Día, <span class="kbd">Espacio</span> = Pausa.</footer>
  </div>
  <div class="scene">
    <div id="cube" class="cube">
      <div class="face" id="front"></div>
      <div class="face" id="back"></div>
      <div class="face" id="right"></div>
      <div class="face" id="left"></div>
      <div class="face" id="top"></div>
      <div class="face" id="bottom"></div>
    </div>
  </div>
</div>
<script>
  // Embedded dataset (real, precomputed)
  const DATA = {"athletes": [{"id": 0, "date": ["2024-08-18", "2024-08-19", "2024-08-20", "2024-08-21", "2024-08-22", "2024-08-23", "2024-08-24", "2024-08-25", "2024-08-26", "2024-08-27", "2024-08-28", "2024-08-29", "2024-08-30", "2024-08-31", "2024-09-01", "2024-09-02", "2024-09-03", "2024-09-04", "2024-09-05", "2024-09-06", "2024-09-07", "2024-09-08", "2024-09-09", "2024-09-10", "2024-09-11", "2024-09-12", "2024-09-13", "2024-09-14", "2024-09-15", "2024-09-16", "2024-09-17", "2024-09-18", "2024-09-19", "2024-09-20", "2024-09-21", "2024-09-22", "2024-09-23", "2024-09-24", "2024-09-25", "2024-09-26", "2024-09-27", "2024-09-28", "2024-09-29", "2024-09-30", "2024-10-01", "2024-10-02", "2024-10-03", "2024-10-04", "2024-10-05", "2024-10-06", "2024-10-07", "2024-10-08", "2024-10-09", "2024-10-10", "2024-10-11", "2024-10-12", "2024-10-13", "2024-10-14", "2024-10-15", "2024-10-16", "2024-10-17", "2024-10-18", "2024-10-19", "2024-10-20", "2024-10-21", "2024-10-22", "2024-10-23", "2024-10-24", "2024-10-25", "2024-10-26", "2024-10-27", "2024-10-28", "2024-10-29", "2024-10-30", "2024-10-31", "2024-11-01", "2024-11-02", "2024-11-03", "2024-11-04", "2024-11-05", "2024-11-06", "2024-11-07", "2024-11-08", "2024-11-09", "2024-11-10", "2024-11-11", "2024-11-12", "2024-11-13", "2024-11-14", "2024-11-15", "2024-11-16", "2024-11-17", "2024-11-18", "2024-11-19", "2024-11-20", "2024-11-21", "2024-11-22", "2024-11-23", "2024-11-24", "2024-11-25", "2024-11-26", "2024-11-27", "2024-11-28", "2024-11-29", "2024-11-30", "2024-12-01", "2024-12-02", "2024-12-03", "2024-12-04", "2024-12-05", "2024-12-06", "2024-12-07", "2024-12-08", "2024-12-09", "2024-12-10", "2024-12-11", "2024-12-12", "2024-12-13", "2024-12-14", "2024-12-15", "2024-12-16", "2024-12-17", "2024-12-18", "2024-12-19", "2024-12-20", "2024-12-21", "2024-12-22", "2024-12-23", "2024-12-24", "2024-12-25", "2024-12-26", "2024-12-27", "2024-12-28", "2024-12-29", "2024-12-30", "2024-12-31", "2025-01-01", "2025-01-02", "2025-01-03", "2025-01-04", "2025-01-05", "2025-01-06", "2025-01-07", "2025-01-08", "2025-01-09", "2025-01-10", "2025-01-11", "2025-01-12", "2025-01-13", "2025-01-14", "2025-01-15", "2025-01-16", "2025-01-17", "2025-01-18", "2025-01-19", "2025-01-20", "2025-01-21", "2025-01-22", "2025-01-23", "2025-01-24", "2025-01-25", "2025-01-26", "2025-01-27", "2025-01-28", "2025-01-29", "2025-01-30", "2025-01-31", "2025-02-01", "2025-02-02", "2025-02-03", "2025-02-04", "2025-02-05", "2025-02-06", "2025-02-07", "2025-02-08", "2025-02-09", "2025-02-10", "2025-02-11", "2025-02-12", "2025-02-13", "2025-02-14", "2025-02-15", "2025-02-16", "2025-02-17", "2025-02-18", "2025-02-19", "2025-02-20", "2025-02-21", "2025-02-22", "2025-02-23", "2025-02-24", "2025-02-25", "2025-02-26", "2025-02-27", "2025-02-28", "2025-03-01", "2025-03-02", "2025-03-03", "2025-03-04", "2025-03-05", "2025-03-06", "2025-03-07", "2025-03-08", "2025-03-09", "2025-03-10", "2025-03-11", "2025-03-12", "2025-03-13", "2025-03-14", "2025-03-15", "2025-03-16", "2025-03-17", "2025-03-18", "2025-03-19", "2025-03-20", "2025-03-21", "2025-03-22", "2025-03-23", "2025-03-24", "2025-03-25", "2025-03-26", "2025-03-27", "2025-03-28", "2025-03-29", "2025-03-30", "2025-03-31", "2025-04-01", "2025-04-02", "2025-04-03", "2025-04-04", "2025-04-05", "2025-04-06", "2025-04-07", "2025-04-08", "2025-04-09", "2025-04-10", "2025-04-11", "2025-04-12", "2025-04-13", "2025-04-14", "2025-04-15", "2025-04-16", "2025-04-17", "2025-04-18", "2025-04-19", "2025-04-20", "2025-04-21", "2025-04-22", "2025-04-23", "2025-04-24", "2025-04-25", "2025-04-26", "2025-04-27", "2025-04-28", "2025-04-29", "2025-04-30", "2025-05-01", "2025-05-02", "2025-05-03", "2025-05-04", "2025-05-05", "2025-05-06", "2025-05-07", "2025-05-08", "2025-05-09", "2025-05-10", "2025-05-11", "2025-05-12", "2025-05-13", "2025-05-14", "2025-05-15", "2025-05-16", "2025-05-17", "2025-05-18", "2025-05-19", "2025-05-20", "2025-05-21", "2025-05-22", "2025-05-23", "2025-05-24", "2025-05-25", "2025-05-26", "2025-05-27", "2025-05-28", "2025-05-29", "2025-05-30", "2025-05-31", "2025-06-01", "2025-06-02", "2025-06-03", "2025-06-04", "2025-06-05", "2025-06-06", "2025-06-07", "2025-06-08", "2025-06-09", "2025-06-10", "2025-06-11", "2025-06-12", "2025-06-13", "2025-06-14", "2025-06-15", "2025-06-16", "2025-06-17", "2025-06-18", "2025-06-19", "2025-06-20", "2025-06-21", "2025-06-22", "2025-06-23", "2025-06-24", "2025-06-25", "2025-06-26", "2025-06-27", "2025-06-28", "2025-06-29", "2025-06-30", "2025-07-01", "2025-07-02", "2025-07-03", "2025-07-04", "2025-07-05", "2025-07-06", "2025-07-07", "2025-07-08", "2025-07-09", "2025-07-10", "2025-07-11", "2025-07-12", "2025-07-13", "2025-07-14", "2025-07-15", "2025-07-16", "2025-07-17", "2025-07-18", "2025-07-19", "2025-07-20", "2025-07-21", "2025-07-22", "2025-07-23", "2025-07-24", "2025-07-25", "2025-07-26", "2025-07-27", "2025-07-28", "2025-07-29", "2025-07-30", "2025-07-31", "2025-08-01", "2025-08-02", "2025-08-03", "2025-08-04", "2025-08-05", "2025-08-06", "2025-08-07", "2025-08-08", "2025-08-09", "2025-08-10", "2025-08-11", "2025-08-12", "2025-08-13", "2025-08-14", "2025-08-15", "2025-08-16", "2025-08-17", "2025-08-18"], "tss": [559.0, 648.0, 917.0, 1096.0, 797.0, 709.0, 1277.0, 618.0, 554.0, 1023.0, 1037.0, 930.0, 891.0, 1075.0, 873.0, 625.0, 1249.0, 896.0, 901.0, 802.0, 1675.0, 729.0, 562.0, 945.0, 969.0, 1112.0, 879.0, 1621.0, 765.0, 629.0, 800.0, 936.0, 672.0, 742.0, 1153.0, 950.0, 269.0, 814.0, 870.0, 669.0, 484.0, 1349.0, 409.0, 516.0, 764.0, 964.0, 604.0, 873.0, 1627.0, 726.0, 631.0, 755.0, 859.0, 818.0, 818.0, 941.0, 1159.0, 514.0, 741.0, 658.0, 804.0, 954.0, 1301.0, 566.0, 627.0, 653.0, 933.0, 771.0, 789.0, 1530.0, 668.0, 386.0, 817.0, 1066.0, 565.0, 611.0, 1080.0, 1440.0, 443.0, 496.0, 861.0, 589.0, 636.0, 1011.0, 552.0, 461.0, 721.0, 850.0, 638.0, 810.0, 1264.0, 458.0, 597.0, 664.0, 853.0, 743.0, 625.0, 1064.0, 1665.0, 467.0, 648.0, 878.0, 607.0, 517.0, 963.0, 556.0, 695.0, 536.0, 661.0, 594.0, 671.0, 743.0, 475.0, 496.0, 486.0, 860.0, 448.0, 572.0, 708.0, 779.0, 327.0, 358.0, 721.0, 422.0, 637.0, 687.0, 480.0, 336.0, 741.0, 313.0, 486.0, 682.0, 763.0, 328.0, 570.0, 765.0, 515.0, 512.0, 929.0, 862.0, 507.0, 547.0, 839.0, 839.0, 590.0, 772.0, 1089.0, 539.0, 611.0, 838.0, 914.0, 830.0, 802.0, 1020.0, 475.0, 713.0, 885.0, 939.0, 662.0, 753.0, 1177.0, 598.0, 541.0, 933.0, 861.0, 588.0, 614.0, 1517.0, 634.0, 561.0, 981.0, 817.0, 850.0, 817.0, 1276.0, 832.0, 718.0, 906.0, 1024.0, 752.0, 752.0, 1539.0, 582.0, 630.0, 980.0, 976.0, 819.0, 855.0, 1378.0, 733.0, 613.0, 829.0, 1144.0, 717.0, 856.0, 1392.0, 800.0, 304.0, 648.0, 947.0, 460.0, 434.0, 764.0, 1786.0, 281.0, 668.0, 977.0, 765.0, 648.0, 948.0, 1219.0, 431.0, 628.0, 1111.0, 862.0, 881.0, 1651.0, 779.0, 655.0, 1193.0, 1190.0, 772.0, 938.0, 1414.0, 653.0, 510.0, 781.0, 974.0, 728.0, 615.0, 980.0, 1749.0, 323.0, 754.0, 951.0, 910.0, 994.0, 1493.0, 764.0, 735.0, 1033.0, 1206.0, 1091.0, 959.0, 1433.0, 713.0, 844.0, 1028.0, 1198.0, 787.0, 699.0, 1693.0, 1072.0, 626.0, 956.0, 1533.0, 842.0, 818.0, 1725.0, 989.0, 732.0, 993.0, 1412.0, 535.0, 1026.0, 1930.0, 767.0, 718.0, 1010.0, 1617.0, 746.0, 882.0, 1697.0, 831.0, 288.0, 754.0, 1005.0, 604.0, 577.0, 1252.0, 758.0, 170.0, 430.0, 457.0, 439.0, 301.0, 472.0, 3035.0, 84.0, 295.0, 503.0, 508.0, 531.0, 470.0, 344.0, 566.0, 698.0, 703.0, 746.0, 533.0, 478.0, 312.0, 722.0, 791.0, 961.0, 729.0, 849.0, 1073.0, 591.0, 600.0, 741.0, 1029.0, 647.0, 1116.0, 767.0, 494.0, 611.0, 865.0, 912.0, 811.0, 890.0, 874.0, 899.0, 616.0, 1005.0, 752.0, 918.0, 873.0, 1140.0, 819.0, 730.0, 1037.0, 996.0, 1134.0, 1222.0, 1438.0, 580.0, 584.0, 1054.0, 1032.0, 1005.0, 972.0, 1242.0, 647.0, 647.0, 799.0, 1080.0, 886.0, 1066.0, 1412.0, 874.0, 575.0, 943.0, 971.0, 984.0, 783.0, 1083.0, 937.0, 655.0, 975.0, 1040.0, 1091.0, 739.0, 1479.0, 600.0, 130.0], "ekg": [14.571, 5.814, 20.971, 16.571, 14.8, 3.2, 30.343, 17.071, 2.771, 22.086, 16.071, 18.371, 4.857, 26.514, 23.114, 1.2, 24.271, 18.429, 14.814, 4.2, 39.7, 19.957, 1.271, 18.757, 18.914, 14.871, 4.243, 38.014, 20.914, 2.943, 16.286, 12.929, 12.571, 4.557, 27.329, 20.986, 0.7, 15.314, 13.886, 12.4, 6.043, 29.043, 10.329, 1.1, 16.686, 14.9, 9.957, 4.657, 39.371, 19.871, 1.271, 15.086, 10.114, 14.057, 11.157, 24.543, 15.2, 2.186, 11.714, 9.857, 11.786, 11.286, 30.586, 16.014, 4.0, 15.129, 12.586, 15.214, 2.586, 36.486, 15.214, 1.043, 16.514, 12.386, 11.6, 3.671, 26.729, 21.5, 0.857, 10.971, 9.486, 13.671, 5.543, 23.114, 14.257, 0.9, 14.443, 11.343, 13.486, 2.271, 31.171, 12.443, 6.543, 11.614, 11.071, 14.457, 3.071, 25.714, 40.357, 0.786, 13.914, 10.757, 9.557, 3.957, 23.014, 14.814, 5.429, 12.4, 7.629, 12.443, 7.057, 19.643, 12.743, 2.514, 12.386, 12.029, 8.086, 5.114, 16.043, 17.0, 2.4, 6.943, 6.914, 10.843, 5.557, 12.671, 9.571, 4.2, 13.014, 8.543, 11.343, 8.543, 17.786, 8.029, 6.486, 13.029, 11.886, 8.157, 10.243, 17.229, 11.0, 4.971, 10.7, 12.943, 8.771, 7.271, 22.586, 10.671, 5.057, 12.257, 12.0, 15.871, 5.9, 19.657, 9.086, 4.957, 14.771, 8.971, 11.7, 6.157, 25.786, 13.957, 4.8, 14.1, 14.114, 10.614, 4.7, 31.257, 12.443, 1.829, 17.129, 16.057, 14.414, 4.029, 25.043, 22.457, 3.657, 14.886, 16.886, 12.714, 1.0, 34.457, 16.514, 2.857, 18.514, 14.757, 11.686, 5.971, 31.557, 19.029, 2.686, 16.786, 18.3, 12.743, 4.986, 28.843, 20.786, 0.614, 12.486, 13.414, 7.4, 1.5, 17.714, 29.8, 0.286, 12.343, 14.2, 10.814, 7.786, 20.414, 27.514, 0.629, 12.643, 16.543, 17.3, 2.786, 37.057, 20.0, 4.843, 20.943, 19.129, 13.5, 2.757, 28.771, 15.243, 3.343, 14.529, 15.014, 8.014, 6.914, 20.843, 36.4, 0.486, 15.757, 15.343, 13.457, 9.429, 34.471, 19.629, 1.014, 20.657, 16.286, 14.4, 11.957, 29.657, 19.986, 1.271, 19.929, 16.357, 11.086, 1.0, 38.186, 21.743, 1.414, 16.586, 21.629, 18.571, 2.4, 37.1, 22.943, 1.5, 16.086, 23.143, 13.071, 4.629, 43.571, 18.857, 1.0, 15.571, 24.157, 13.357, 5.257, 37.614, 17.757, 0.429, 11.671, 12.057, 9.8, 1.0, 26.714, 18.243, 1.071, 7.886, 6.457, 8.614, 1.829, 9.957, 72.771, 0.143, 5.029, 3.714, 9.986, 3.686, 13.8, 9.457, 0.757, 11.171, 9.343, 13.629, 4.486, 11.386, 6.3, 5.329, 12.2, 9.186, 13.714, 11.271, 23.643, 11.857, 0.871, 15.371, 11.929, 12.886, 12.157, 18.757, 14.029, 0.786, 13.5, 13.357, 11.829, 9.529, 17.671, 22.5, 0.8, 15.643, 13.3, 14.914, 8.129, 18.614, 22.914, 1.943, 14.5, 18.243, 12.886, 12.6, 28.814, 14.771, 2.929, 18.143, 19.071, 15.714, 12.414, 27.386, 19.371, 0.957, 14.6, 17.843, 18.843, 10.114, 30.629, 20.471, 0.857, 17.043, 18.143, 17.114, 10.586, 24.657, 22.614, 1.714, 17.057, 17.771, 15.257, 7.271, 34.786, 19.157, 0.157], "hrv_pre_ms": [71.714, 76.286, 73.714, 78.714, 75.429, 75.571, 64.714, 74.143, 78.571, 74.0, 76.143, 71.857, 77.857, 76.429, 74.571, 79.429, 76.571, 78.714, 78.571, 76.857, 75.571, 76.571, 82.0, 78.857, 78.429, 81.857, 80.571, 76.857, 78.0, 81.857, 78.714, 81.714, 78.714, 82.0, 81.857, 76.0, 76.429, 85.286, 79.286, 78.0, 81.429, 79.714, 76.0, 81.857, 71.143, 75.714, 80.571, 80.714, 71.857, 77.857, 80.143, 78.286, 80.286, 76.857, 78.571, 78.714, 78.857, 81.714, 76.714, 76.714, 74.857, 76.571, 71.0, 75.857, 77.571, 75.0, 73.143, 77.571, 80.286, 72.143, 79.0, 79.0, 76.429, 76.143, 76.857, 78.429, 68.143, 75.286, 78.571, 74.714, 74.857, 75.286, 79.714, 66.571, 76.0, 75.0, 74.286, 72.714, 68.143, 76.857, 70.286, 76.0, 79.857, 77.143, 76.857, 74.286, 76.286, 72.571, 75.0, 82.714, 81.286, 80.714, 78.143, 78.286, 68.143, 75.143, 80.857, 73.714, 77.0, 72.429, 71.143, 68.143, 74.714, 75.286, 67.571, 75.429, 75.857, 79.0, 70.429, 71.714, 78.143, 76.429, 74.0, 75.429, 80.286, 70.286, 69.429, 76.714, 75.429, 70.857, 77.571, 79.571, 71.143, 72.143, 76.286, 72.286, 70.0, 78.375, 79.625, 73.75, 78.5, 76.25, 72.0, 75.875, 78.875, 76.375, 75.25, 76.625, 77.75, 77.25, 77.875, 72.375, 78.125, 72.5, 75.375, 76.625, 76.25, 73.375, 77.375, 77.0, 69.25, 79.875, 79.625, 70.75, 79.75, 77.75, 78.25, 66.125, 74.125, 76.375, 80.375, 79.25, 75.0, 78.375, 74.0, 76.0, 78.5, 74.5, 76.875, 78.75, 79.5, 72.25, 80.375, 81.75, 78.125, 82.0, 76.875, 76.75, 74.375, 77.75, 80.875, 80.5, 79.75, 81.5, 78.625, 76.625, 78.75, 83.0, 81.625, 81.75, 81.375, 79.25, 78.75, 74.125, 78.375, 77.625, 81.75, 82.125, 78.75, 74.875, 73.5, 82.75, 69.25, 76.625, 75.625, 76.875, 66.875, 77.625, 81.0, 75.625, 77.0, 77.875, 80.0, 74.125, 78.75, 83.625, 78.25, 80.0, 74.25, 76.75, 73.875, 73.0, 82.5, 79.875, 77.0, 74.75, 79.5, 68.625, 76.375, 77.25, 78.75, 77.75, 72.625, 80.5, 74.625, 79.25, 78.375, 79.0, 79.875, 77.75, 80.625, 72.0, 74.0, 82.375, 80.5, 80.25, 74.25, 75.875, 72.625, 77.5, 81.5, 77.625, 78.125, 78.125, 75.375, 70.25, 80.0, 80.25, 74.5, 77.625, 71.0, 79.625, 72.875, 78.625, 80.5, 77.625, 77.375, 77.0, 79.25, 68.75, 75.5, 78.75, 76.125, 76.875, 72.75, 74.625, 74.5, 63.875, 75.0, 74.75, 71.0, 71.0, 71.5, 65.25, 69.375, 71.5, 66.875, 69.75, 69.625, 75.0, 71.375, 70.875, 75.0, 76.25, 77.125, 74.375, 75.25, 72.125, 78.0, 78.0, 77.25, 77.0, 76.875, 77.5, 74.875, 77.125, 78.625, 78.0, 78.375, 76.625, 78.0, 70.875, 75.25, 78.625, 75.25, 81.375, 75.375, 77.625, 72.5, 77.125, 79.375, 78.0, 79.625, 73.75, 76.875, 72.25, 80.25, 82.5, 78.0, 78.625, 78.875, 78.625, 71.375, 76.75, 79.375, 76.5, 75.875, 74.125, 76.0, 67.5, 78.125, 77.875, 75.875, 78.5, 75.625, 78.25, 69.375, 75.625, 81.875, 78.25, 80.875, 79.0, 73.857, 72.0, 80.714, 82.143], "hrv_post_ms": [56.714, 56.429, 47.571, 43.857, 53.429, 55.0, 33.429, 54.857, 61.714, 42.571, 43.714, 45.714, 50.571, 44.571, 52.714, 60.714, 43.857, 51.286, 51.571, 52.143, 31.0, 56.429, 62.857, 52.857, 49.714, 45.571, 51.429, 34.714, 56.429, 64.714, 59.143, 52.0, 60.143, 56.286, 47.571, 49.286, 77.143, 63.286, 51.143, 64.0, 65.429, 50.143, 62.286, 64.429, 49.857, 50.714, 60.429, 52.857, 32.714, 57.286, 60.571, 59.714, 57.0, 55.571, 53.286, 56.857, 48.857, 64.857, 58.0, 55.857, 53.286, 50.571, 40.571, 59.429, 58.571, 57.0, 47.286, 55.429, 55.857, 36.286, 59.286, 63.571, 55.286, 43.429, 56.429, 57.429, 45.286, 43.143, 64.571, 61.571, 48.429, 56.857, 59.857, 42.571, 62.714, 61.0, 54.143, 47.0, 51.857, 52.0, 38.429, 62.0, 60.0, 54.143, 48.571, 53.714, 55.286, 41.143, 48.0, 66.571, 64.0, 54.429, 60.429, 67.857, 48.143, 56.571, 61.143, 57.286, 58.857, 54.143, 49.286, 47.143, 60.0, 59.286, 58.0, 51.0, 61.286, 61.571, 52.714, 53.143, 66.0, 63.571, 53.714, 61.429, 60.714, 54.429, 59.0, 70.0, 54.857, 59.286, 66.571, 53.714, 50.714, 60.0, 63.571, 56.0, 55.571, 72.429, 53.857, 57.0, 71.0, 57.143, 51.429, 52.429, 67.429, 54.571, 52.286, 66.714, 65.857, 56.857, 50.857, 50.714, 51.571, 47.429, 64.429, 60.286, 56.429, 46.429, 57.286, 55.571, 40.429, 61.429, 62.714, 49.286, 54.286, 62.0, 58.429, 37.857, 58.286, 67.714, 51.429, 54.714, 52.143, 54.143, 46.857, 51.0, 58.429, 52.0, 49.571, 55.714, 61.429, 35.714, 60.714, 62.143, 48.143, 49.857, 56.143, 52.714, 37.571, 59.0, 65.0, 60.714, 46.143, 57.143, 53.286, 43.0, 60.714, 73.571, 63.143, 54.429, 65.143, 66.714, 51.571, 40.429, 74.143, 60.429, 55.286, 62.429, 60.571, 47.714, 47.286, 67.0, 51.429, 47.857, 53.143, 54.857, 28.714, 59.0, 63.143, 45.429, 38.571, 56.429, 55.0, 37.143, 61.857, 65.714, 56.0, 56.143, 55.571, 52.857, 47.429, 49.143, 71.143, 57.571, 46.286, 50.286, 50.571, 29.571, 56.286, 57.286, 50.286, 44.286, 42.143, 55.0, 40.286, 57.571, 63.0, 52.0, 40.429, 59.571, 62.429, 33.286, 51.0, 62.857, 56.143, 38.857, 53.571, 57.714, 38.857, 60.0, 63.143, 55.286, 41.143, 60.429, 51.857, 35.143, 61.143, 62.286, 51.143, 33.571, 51.429, 51.429, 40.286, 62.286, 71.857, 61.571, 54.714, 60.857, 61.857, 41.0, 59.714, 72.857, 65.857, 63.571, 58.571, 59.714, 59.0, 33.857, 69.286, 63.429, 54.714, 57.857, 57.714, 48.857, 55.857, 56.286, 48.571, 49.429, 48.0, 59.0, 59.714, 60.714, 55.571, 57.286, 53.429, 58.571, 53.429, 45.714, 62.429, 59.429, 57.857, 48.571, 62.0, 48.571, 53.0, 62.0, 61.571, 53.286, 49.143, 52.714, 51.857, 49.571, 56.714, 62.143, 48.143, 60.714, 48.0, 53.0, 42.857, 57.0, 59.429, 51.0, 51.143, 42.0, 43.0, 37.286, 63.857, 62.0, 50.429, 50.286, 53.286, 49.0, 40.0, 58.143, 65.0, 57.429, 47.143, 47.857, 48.0, 32.571, 54.714, 58.714, 51.571, 53.143, 47.857, 57.429, 43.0, 52.571, 62.714, 53.143, 50.143, 46.857, 56.286, 33.429, 62.286, 80.571], "u_plt": [0.571993, 0.394075, 1.181984, 1.196782, 0.71472, 0.395546, 2.746724, 0.678376, 0.260927, 1.440802, 1.18066, 1.230082, 0.542753, 1.596131, 1.201491, 0.252652, 1.876382, 0.990924, 0.838091, 0.500294, 3.730441, 0.845173, 0.210915, 1.075406, 1.20509, 1.194143, 0.523937, 3.471786, 0.871513, 0.263398, 0.68649, 0.740517, 0.509493, 0.375246, 1.302589, 1.256896, 0.040766, 0.365029, 0.753066, 0.190619, 0.216555, 1.28621, 0.316678, 0.185428, 0.876346, 1.011374, 0.253203, 0.507477, 3.860679, 0.835984, 0.266229, 0.408619, 0.398197, 0.734934, 0.622362, 0.810266, 1.216257, 0.192055, 0.594754, 0.473783, 0.668661, 0.829824, 2.603711, 0.547983, 0.369086, 0.605551, 0.691866, 0.712115, 0.397984, 3.368443, 0.568806, 0.165335, 0.814377, 1.10876, 0.438229, 0.320272, 2.054576, 2.322764, 0.201451, 0.368163, 0.78526, 0.543547, 0.365431, 1.898532, 0.314341, 0.234292, 0.740478, 0.916543, 0.782091, 0.468271, 2.641451, 0.409354, 0.322436, 0.53932, 0.815062, 0.786529, 0.228307, 1.797999, 3.897623, 0.166137, 0.293596, 0.432301, 0.232944, 0.050808, 1.212983, 0.529252, 0.224228, 0.472371, 0.294522, 0.563308, 0.5443, 0.704186, 0.438707, 0.300831, 0.498318, 0.872455, 0.299683, 0.106987, 0.855862, 0.986041, 0.161329, 0.231184, 0.5668, 0.310509, 0.350157, 0.501621, 0.307456, 0.107872, 0.697599, 0.319898, 0.214822, 0.447827, 1.023969, 0.293083, 0.136718, 0.535009, 0.599395, 0.191172, 0.563781, 0.721504, 0.138351, 0.360039, 0.848502, 0.62986, 0.362032, 0.584787, 1.578872, 0.248623, 0.210678, 0.724001, 0.824182, 0.963684, 0.556617, 1.523636, 0.218132, 0.289182, 0.846714, 0.951546, 0.554449, 0.522056, 2.205062, 0.48539, 0.294816, 1.087224, 0.776744, 0.261149, 0.342707, 3.453605, 0.417378, 0.121077, 1.070473, 0.810423, 0.876771, 0.537289, 2.064637, 0.833129, 0.436618, 0.920876, 1.224541, 0.601239, 0.243171, 3.297624, 0.491591, 0.267549, 1.063696, 0.883348, 0.690618, 0.608779, 2.722412, 0.82343, 0.257558, 0.493334, 1.013518, 0.529007, 0.561167, 2.385178, 0.629984, 0.064128, 0.41646, 0.774196, 0.213285, 0.163695, 0.708456, 3.623043, 0.076532, 0.529441, 0.849194, 0.485836, 0.276505, 1.252535, 2.195395, 0.15073, 0.691508, 1.376198, 1.018333, 0.403678, 4.105954, 0.873039, 0.329295, 1.620756, 1.610492, 0.646343, 0.550338, 2.600759, 0.55487, 0.18638, 0.432943, 0.935891, 0.514838, 0.372356, 1.34757, 1.664517, 0.07592, 0.655278, 1.022617, 0.980862, 0.788319, 3.46152, 0.904572, 0.378289, 1.244571, 1.517551, 1.428614, 0.792266, 2.328112, 0.768085, 0.280447, 1.243523, 1.407716, 0.628918, 0.303782, 3.848095, 1.60007, 0.245445, 0.8831, 2.257294, 0.954747, 0.315057, 3.311611, 0.989584, 0.293371, 0.721022, 2.077766, 0.37835, 0.766172, 4.803352, 0.728232, 0.309709, 0.835043, 2.755347, 0.832735, 0.561736, 3.758884, 0.59133, 0.069868, 0.395596, 0.453341, 0.263509, 0.152099, 1.975389, 0.597363, 0.093763, 0.101975, 0.164607, 0.29384, 0.1653, 0.326048, 9.548431, 0.101396, 0.202666, 0.359897, 0.295809, 0.369315, 0.682544, 0.39621, 0.364838, 0.888386, 0.774558, 1.016241, 0.357637, 0.494116, 0.279645, 0.528831, 0.688319, 0.600622, 0.739913, 0.861221, 1.860148, 0.489613, 0.302016, 0.750116, 1.112457, 0.355387, 0.909694, 0.959848, 0.463601, 0.301396, 0.848412, 0.922075, 0.753854, 0.802039, 1.252386, 1.352239, 0.319944, 1.219133, 0.568993, 0.753408, 0.737843, 1.720037, 1.067429, 0.391998, 1.091152, 1.186258, 1.040875, 1.517437, 2.887892, 0.485462, 0.257631, 1.306847, 1.228558, 1.067591, 0.951176, 1.918216, 0.786137, 0.185768, 0.518094, 1.408757, 1.124434, 1.086577, 3.113719, 1.040119, 0.26429, 1.096644, 0.800512, 1.242187, 0.646382, 2.081948, 1.398592, 0.280805, 1.088292, 1.179343, 1.279131, 0.590687, 3.319929, 0.584391, 0.026296], "CTL_TSS": [13.152327, 28.089222, 49.003793, 73.637848, 90.65734, 105.2059, 132.776238, 144.192735, 153.834809, 174.2848, 194.583033, 211.886154, 227.864557, 247.796226, 262.506216, 271.035083, 294.044948, 308.207935, 322.155333, 333.445268, 365.009789, 373.573864, 378.007213, 391.347597, 404.938784, 421.574742, 432.337187, 460.304418, 467.473391, 471.27384, 479.008212, 489.760458, 494.048247, 499.882133, 515.248895, 525.477855, 519.443364, 526.373785, 534.45873, 537.624259, 536.362571, 555.482559, 552.036072, 551.188204, 556.195306, 565.790263, 566.689273, 573.896248, 598.674003, 601.669769, 602.35986, 605.951225, 611.905036, 616.754103, 621.489079, 629.006632, 641.476482, 638.477176, 640.889365, 641.291949, 645.120195, 652.387616, 667.648372, 665.256757, 664.35664, 664.089437, 670.416449, 672.783011, 675.5174, 695.621935, 694.972037, 687.702446, 690.7446, 699.573726, 696.407433, 694.397941, 703.470507, 720.799803, 714.263643, 709.128267, 712.701553, 709.791064, 708.054885, 715.182672, 711.343259, 705.453105, 705.818897, 709.211235, 707.535755, 709.946566, 722.982508, 716.747917, 713.93045, 712.755671, 716.055384, 716.689345, 714.532049, 722.754441, 744.92389, 738.384809, 736.258207, 739.593152, 736.473459, 731.309619, 736.760903, 732.507904, 731.625406, 727.02267, 725.469268, 722.376018, 721.167227, 721.680915, 715.876929, 710.703596, 705.416699, 709.053784, 702.911629, 699.831499, 700.02369, 701.881869, 693.061531, 685.178098, 686.020927, 679.80896, 678.801738, 678.994629, 674.312621, 666.352695, 668.109021, 659.753904, 655.665768, 656.285368, 658.796183, 651.013107, 649.107005, 651.833772, 648.614304, 645.4, 652.07263, 657.011867, 653.48234, 650.976991, 655.400855, 659.720633, 658.080224, 660.760564, 670.836316, 667.73443, 666.399564, 670.437033, 676.167659, 679.787075, 682.662539, 690.59952, 685.526827, 686.173224, 690.851283, 696.689804, 695.873611, 697.217699, 708.506167, 705.906143, 702.02618, 707.460604, 711.073127, 708.177424, 705.961588, 725.043954, 722.901844, 719.092566, 725.254806, 727.413416, 730.297672, 732.337631, 745.12909, 747.173016, 746.486624, 750.239705, 756.680823, 756.570691, 756.46315, 774.874922, 770.336901, 767.03501, 772.045717, 776.844417, 777.836267, 779.6518, 793.729924, 792.301051, 788.0824, 789.045122, 797.396611, 795.505015, 796.92836, 810.929392, 810.672242, 798.751098, 795.204179, 798.775679, 790.804859, 782.409842, 781.976689, 805.599665, 793.256719, 790.30964, 794.702149, 794.003308, 790.568096, 794.272203, 804.265332, 795.483028, 791.542435, 799.058733, 800.539635, 802.432731, 822.398088, 821.377004, 817.462434, 826.298199, 834.855489, 833.376606, 835.838218, 849.441389, 844.819455, 836.941718, 835.625503, 838.881222, 836.272374, 831.066208, 834.570369, 856.085356, 843.542757, 841.435967, 844.013823, 845.566367, 849.05876, 864.209611, 861.851848, 858.867238, 862.964288, 871.03534, 876.210737, 878.158629, 891.213111, 887.020057, 886.007867, 889.348703, 896.610747, 894.031791, 889.443022, 908.349363, 912.199786, 905.465988, 906.654968, 921.39181, 919.523855, 917.13517, 936.142866, 937.386506, 932.554108, 933.976297, 945.223389, 935.571524, 937.699154, 961.046319, 956.480737, 950.869687, 952.260924, 967.901113, 962.680154, 960.781886, 978.103857, 974.642751, 958.487205, 953.675966, 954.883534, 946.627836, 937.931117, 945.320628, 940.913289, 922.775, 911.180835, 900.494726, 889.636534, 875.786909, 866.286484, 917.312655, 897.706214, 883.525553, 874.572429, 865.947598, 858.066846, 848.936288, 837.055988, 830.678498, 827.556797, 824.626185, 822.776244, 815.958298, 808.006709, 796.336508, 794.587495, 794.503087, 798.420479, 796.787132, 798.015613, 804.485532, 799.462577, 794.769559, 793.504452, 799.045265, 795.467896, 803.009476, 802.162234, 794.911696, 790.584564, 792.335434, 795.150939, 795.523841, 797.746706, 799.540817, 801.880924, 797.507459, 802.389409, 801.203831, 803.951848, 805.576435, 813.444857, 813.57556, 811.609168, 816.912234, 821.125867, 828.487268, 837.745959, 851.868924, 845.472307, 839.320304, 844.371356, 848.785941, 852.461394, 855.273936, 864.372948, 859.258529, 854.264444, 852.964165, 858.305935, 858.95753, 863.82889, 876.726432, 876.662283, 869.564679, 871.292488, 873.638437, 876.235059, 874.041395, 878.957839, 880.323473, 875.021992, 877.374306, 881.200614, 886.13684, 882.674958, 896.70548, 889.724501, 871.849465], "F_tensor": [0.013458, 0.022413, 0.049696, 0.076685, 0.091697, 0.098846, 0.161146, 0.173316, 0.175377, 0.20515, 0.228102, 0.251677, 0.258526, 0.289997, 0.311443, 0.31006, 0.346913, 0.362065, 0.373266, 0.376254, 0.455173, 0.464349, 0.458386, 0.472903, 0.49013, 0.506695, 0.5071, 0.576854, 0.583787, 0.576249, 0.578843, 0.582647, 0.580925, 0.576086, 0.59318, 0.608796, 0.595431, 0.59001, 0.593846, 0.584359, 0.575705, 0.592422, 0.585935, 0.576511, 0.583566, 0.593631, 0.585622, 0.583783, 0.660883, 0.665003, 0.65562, 0.649809, 0.643889, 0.646031, 0.645474, 0.649351, 0.66269, 0.651616, 0.650279, 0.646126, 0.646656, 0.650966, 0.696911, 0.693407, 0.685776, 0.683888, 0.684076, 0.684736, 0.677989, 0.741291, 0.737232, 0.723777, 0.725908, 0.734916, 0.727936, 0.718344, 0.749783, 0.786793, 0.773021, 0.763495, 0.764007, 0.75882, 0.749564, 0.776598, 0.765722, 0.753218, 0.752918, 0.756768, 0.757364, 0.750562, 0.795051, 0.785977, 0.77507, 0.769523, 0.770595, 0.77097, 0.758202, 0.782667, 0.855956, 0.839726, 0.826876, 0.817593, 0.803837, 0.786119, 0.796163, 0.789883, 0.776574, 0.769417, 0.758243, 0.753657, 0.748731, 0.747683, 0.740413, 0.73007, 0.724618, 0.728096, 0.718016, 0.70364, 0.707221, 0.713781, 0.700783, 0.689734, 0.686842, 0.677987, 0.670274, 0.666306, 0.657863, 0.644922, 0.646162, 0.638485, 0.628517, 0.624266, 0.63367, 0.625657, 0.614153, 0.612291, 0.611987, 0.602086, 0.601185, 0.604016, 0.59306, 0.587577, 0.593716, 0.594567, 0.589095, 0.588994, 0.612284, 0.603728, 0.59448, 0.597527, 0.60286, 0.61135, 0.610062, 0.631557, 0.62183, 0.614003, 0.619478, 0.627291, 0.625577, 0.623142, 0.660362, 0.656245, 0.647741, 0.658081, 0.660873, 0.651469, 0.644204, 0.710304, 0.703412, 0.689711, 0.69867, 0.701299, 0.705428, 0.701471, 0.733544, 0.735888, 0.728846, 0.733364, 0.744921, 0.74154, 0.729815, 0.790231, 0.783204, 0.771072, 0.777957, 0.780436, 0.778323, 0.774334, 0.820169, 0.820246, 0.807007, 0.799626, 0.804659, 0.798173, 0.792597, 0.830068, 0.82536, 0.80745, 0.79825, 0.797684, 0.783934, 0.769341, 0.767909, 0.835085, 0.817238, 0.810466, 0.811378, 0.803718, 0.791314, 0.802165, 0.834946, 0.818847, 0.815851, 0.829035, 0.833489, 0.823376, 0.90061, 0.899961, 0.886534, 0.903809, 0.920436, 0.913987, 0.905431, 0.94532, 0.936133, 0.918493, 0.907068, 0.907747, 0.898502, 0.886123, 0.89698, 0.915039, 0.895296, 0.889648, 0.892777, 0.894849, 0.892343, 0.952791, 0.951657, 0.938166, 0.945376, 0.958838, 0.969891, 0.965712, 0.997767, 0.992363, 0.975613, 0.981916, 0.991934, 0.983393, 0.967403, 1.035181, 1.048472, 1.029578, 1.026132, 1.055099, 1.052738, 1.035381, 1.088937, 1.0866, 1.067936, 1.059774, 1.083726, 1.067129, 1.060048, 1.148122, 1.138243, 1.118749, 1.112073, 1.150737, 1.143255, 1.129573, 1.191436, 1.177316, 1.15126, 1.133481, 1.117478, 1.097386, 1.075145, 1.096326, 1.084586, 1.061274, 1.038703, 1.018137, 1.001096, 0.981431, 0.966011, 1.16794, 1.142847, 1.120726, 1.102825, 1.083837, 1.067025, 1.057979, 1.042409, 1.026467, 1.023218, 1.017367, 1.017341, 1.001819, 0.989874, 0.973163, 0.962709, 0.956253, 0.947886, 0.942992, 0.941068, 0.962693, 0.951562, 0.936279, 0.931899, 0.936147, 0.922483, 0.922182, 0.923068, 0.912258, 0.897885, 0.896721, 0.897318, 0.893942, 0.89178, 0.900265, 0.910899, 0.896995, 0.904574, 0.896678, 0.893307, 0.88965, 0.909187, 0.91291, 0.900654, 0.905136, 0.911751, 0.914789, 0.928968, 0.975058, 0.963539, 0.94693, 0.955398, 0.961825, 0.964314, 0.964005, 0.986456, 0.981742, 0.963015, 0.952546, 0.96328, 0.967072, 0.969884, 1.020324, 1.02079, 1.002991, 1.005195, 1.000379, 1.006068, 0.997605, 1.023118, 1.031952, 1.014279, 1.01602, 1.019863, 1.025963, 1.015722, 1.069936, 1.058512, 1.034226]}]};

  const DOMElements = {
    cube: document.getElementById('cube'),
    faces: {
      front: document.getElementById('front'),
      back: document.getElementById('back'),
      right: document.getElementById('right'),
      left: document.getElementById('left'),
      top: document.getElementById('top'),
      bottom: document.getElementById('bottom'),
    },
    controls: {
      athSel: document.getElementById('athSel'),
      dayIdx: document.getElementById('dayIdx'),
      dayLabel: document.getElementById('dayLabel'),
      spd: document.getElementById('spd'),
      spdOut: document.getElementById('spdOut'),
      pause: document.getElementById('pause'),
      autoroll: document.getElementById('autoroll'),
    },
    valueDisplays: {
        tss: document.getElementById('val-tss'),
        ekg: document.getElementById('val-ekg'),
        hrvPre: document.getElementById('val-hrv-pre'),
        hrvPost: document.getElementById('val-hrv-post'),
    }
  };

  // === Dimension mapping based on the paper ===
  const DIM_OF_FACE = {
    front: 'Resumen del Día',
    right: 'TSS (Carga)',
    left: 'HRV Pre-Sesión',
    back: 'Energía Específica',
    top: 'Impulso Diario (u_PLT)',
    bottom: 'HRV Post-Sesión'
  };

  function setBadge(faceEl, text) {
    let b = faceEl.querySelector('.dimBadge');
    if (!b) {
      b = document.createElement('div');
      b.className = 'dimBadge';
      faceEl.appendChild(b);
    }
    b.textContent = text;
  }

  // Position the faces in 3D
  const size = 300, half = size/2;
  DOMElements.faces.front.style.transform  = `translateZ(${half}px)`;
  DOMElements.faces.back.style.transform   = `rotateY(180deg) translateZ(${half}px)`;
  DOMElements.faces.right.style.transform  = `rotateY(90deg) translateZ(${half}px)`;
  DOMElements.faces.left.style.transform   = `rotateY(-90deg) translateZ(${half}px)`;
  DOMElements.faces.top.style.transform    = `rotateX(90deg) translateZ(${half}px)`;
  DOMElements.faces.bottom.style.transform = `rotateX(-90deg) translateZ(${half}px)`;

  // Populate athlete selector
  DATA.athletes.forEach(a => {
    const opt = document.createElement('option');
    opt.value = a.id;
    opt.textContent = `Atleta ${a.id}`;
    DOMElements.controls.athSel.appendChild(opt);
  });

  let athlete = DATA.athletes[0];
  let idx = 0;

  function setAthlete(id) {
    const a = DATA.athletes.find(x => String(x.id) === String(id));
    if (!a) return;
    athlete = a;
    DOMElements.controls.dayIdx.max = Math.max(0, athlete.date.length - 1);
    idx = athlete.date.length > 1 ? athlete.date.length - 1 : 0;
    DOMElements.controls.dayIdx.value = idx;
    updateVisualization();
  }

  function fmt(x, d=2) { return (x == null || isNaN(x)) ? '—' : Number(x).toFixed(d); }
  function clamp(v, lo, hi) { return Math.max(lo, Math.min(hi, v)); }

  function updateVisualization() {
    idx = +DOMElements.controls.dayIdx.value;
    DOMElements.controls.dayLabel.textContent = `${idx + 1}/${athlete.date.length} — ${athlete.date[idx] || ''}`;

    // Extract data for the current day
    const tss = athlete.tss[idx];
    const u_plt = athlete.u_plt[idx];
    const ctl_tss = athlete.CTL_TSS[idx];
    const f_tensor = athlete.F_tensor[idx];
    const ekg = athlete.ekg[idx];
    const hrv_pre = athlete.hrv_pre_ms[idx];
    const hrv_post = athlete.hrv_post_ms[idx];

    // --- Update PLT components panel ---
    DOMElements.valueDisplays.tss.textContent = fmt(tss, 1);
    DOMElements.valueDisplays.ekg.textContent = fmt(ekg, 1);
    DOMElements.valueDisplays.hrvPre.textContent = fmt(hrv_pre, 1);
    DOMElements.valueDisplays.hrvPost.textContent = fmt(hrv_post, 1);

    // --- Update Cube Faces ---
    // Front Face: Day Summary
    DOMElements.faces.front.innerHTML = `<div>
      <div class="big">Día ${idx + 1}</div>
      <small>${athlete.date[idx] || ''}</small>
      <div style="margin-top: 12px; font-size: 14px;">
        <div>CTL (TSS): <span class="kbd">${fmt(ctl_tss, 1)}</span></div>
        <div>F_tensor: <span class="kbd">${fmt(f_tensor, 2)}</span></div>
      </div>
    </div>`;

    // Right Face: TSS
    DOMElements.faces.right.innerHTML = `<div>TSS<br><span class="val">${fmt(tss, 1)}</span><small>Training Stress Score</small></div>`;

    // Left Face: Pre-session HRV
    DOMElements.faces.left.innerHTML = `<div>HRV Pre-Sesión<br><span class="val">${fmt(hrv_pre, 1)}</span><small>rMSSD (ms)</small></div>`;

    // Back Face: Specific Energy
    DOMElements.faces.back.innerHTML = `<div>Energía Específica<br><span class="val">${fmt(ekg, 1)}</span><small>kJ/kg (proxy)</small></div>`;
    
    // Top Face: u_PLT (Daily Impulse)
    DOMElements.faces.top.innerHTML = `<div>Impulso Diario (u_PLT)<br><span class="val">${fmt(u_plt, 3)}</span><small>Escalar derivado del tensor</small></div>`;

    // Bottom Face: Post-session HRV
    DOMElements.faces.bottom.innerHTML = `<div>HRV Post-Sesión<br><span class="val">${fmt(hrv_post, 1)}</span><small>rMSSD (ms)</small></div>`;

    // Set all badges
    for (const [faceKey, faceEl] of Object.entries(DOMElements.faces)) {
        setBadge(faceEl, DIM_OF_FACE[faceKey]);
    }
    
    // Top face brightness encodes u_plt
    const norm_u = clamp(u_plt / 4.0, 0, 1); // Heuristic normalization
    DOMElements.faces.top.style.background = `linear-gradient(180deg, rgba(176, 255, 181, ${0.1 + norm_u * 0.6}), rgba(176, 255, 181, 0.08))`;
  }

  // --- Event Listeners ---
  DOMElements.controls.athSel.addEventListener('change', e => setAthlete(e.target.value));
  DOMElements.controls.dayIdx.addEventListener('input', updateVisualization);
  
  // --- Animation Loop ---
  let speedY = 20;
  let angleX = -15, angleY = -30;
  let lastTime = performance.now();
  DOMElements.controls.spd.addEventListener('input', e => {
    speedY = +e.target.value;
    DOMElements.controls.spdOut.textContent = speedY;
  });
  DOMElements.controls.spdOut.textContent = speedY;

  function tick(currentTime) {
    const dt = (currentTime - lastTime) / 1000;
    lastTime = currentTime;
    if (!DOMElements.controls.pause.checked) {
      angleY += speedY * dt;
      if (DOMElements.controls.autoroll.checked) angleX += (speedY * 0.25) * dt;
    }
    DOMElements.cube.style.transform = `rotateX(${angleX}deg) rotateY(${angleY}deg)`;
    requestAnimationFrame(tick);
  }
  
  // --- Keyboard Shortcuts ---
  window.addEventListener('keydown', (e) => {
    const dayInput = DOMElements.controls.dayIdx;
    if (e.code === 'Space') {
      DOMElements.controls.pause.checked = !DOMElements.controls.pause.checked;
      e.preventDefault();
    } else if (e.key === 'ArrowRight') {
      dayInput.value = Math.min(+dayInput.max, +dayInput.value + 1);
      dayInput.dispatchEvent(new Event('input'));
    } else if (e.key === 'ArrowLeft') {
      dayInput.value = Math.max(0, +dayInput.value - 1);
      dayInput.dispatchEvent(new Event('input'));
    }
  });

  // --- Initialisation ---
  const initialAthleteId = (DATA.athletes[0] && DATA.athletes[0].id) || 0;
  setAthlete(initialAthleteId);
  requestAnimationFrame(tick);
</script>
</body>
</html>